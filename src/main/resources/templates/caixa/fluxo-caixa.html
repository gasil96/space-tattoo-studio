<!DOCTYPE html>
<html layout:decorate="~{layout-principal}">
<head>
<style type="text/css">
.cssTeste {
	color: red;
}
</style>
<meta charset="UTF-8" />
<body>
	<h2 layout:fragment="titulosubCabecalho">Controle Caixa Diário</h2>

	<li layout:fragment="caminho">Caixa</li>

	<div layout:fragment="corpo">

		<section id="testes"></section>

		<section class="no-padding-bottom">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<div class="stats-2-block block d-flex">
							<div class="stats-2 d-flex">
								<div th:if="${sumValorEntradaDia >= 0}">
									<div class="stats-2-arrow height">
										<i class="fa fa-caret-up"></i>
									</div>
								</div>
								<div class="stats-2-content">
									<strong class="d-block">R$ <strong
										th:text="${sumValorEntradaDia}">2387.00</strong></strong><span
										class="d-block">Entrada</span>
								</div>
							</div>
							<div class="stats-2 d-flex">
								<div class="stats-2-arrow low">
									<i class="fa fa-caret-down"></i>
								</div>
								<div class="stats-2-content">
									<strong class="d-block">R$ <strong
										th:text=${sumValorSaidaDia}>758.00</strong></strong><span
										class="d-block">Saída</span>
								</div>
							</div>
							<div class="stats-2 d-flex">
								<div th:if="${calculoValorTotalDia >= 0}">
									<div class="stats-2-arrow height">
										<i class="fa fa-caret-up"></i>
									</div>
								</div>
								<div th:unless="${calculoValorTotalDia >= 0}">
									<div class="stats-2-arrow low">
										<i class="fa fa-caret-down"></i>
									</div>
								</div>
								<div class="stats-2-content">
									<strong class="d-block">R$ <strong
										th:text="${calculoValorTotalDia}">3145.00</strong></strong><span
										class="d-block">Saldo Atual</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<section>
			<div class="col-lg-12">
				<div class="block">
					<div class="title">
						<strong>Adicionar Crédito ao Cliente!</strong>
					</div>
					<div class="block-body">
						<form class="form-inline" th:action="@{/cliente/credito}"
							th:object="${cliente}" method="POST">
							<div class="form-group">
								<input id="inlineFormInput" style="margin-right: 0px"
									th:field="*{creditoCliente}" type="text"
									placeholder="Valor Pago" class="form-control">
							</div>
							<div class="form-group">
								<div class="form-group">
									<div class="input-group">
										<input type="text" class="form-control"
											style="margin-left: 20px" id="typeaheadIdInstaNomeCliente"
											placeholder="Insira o Cliente" th:field="*{id}">
										<div class="input-group-append">
											<button type="submit" class="btn btn-primary">Adicionar</button>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</section>

		<section>
			<div class="col-lg-8">
				<div class="block">
					<div class="block-body">
						<div id="abrir-caixa" th:unless="${caixaAberto}">
							<form class="form-inline" th:action="@{/caixa/abrir-caixa}"
								th:object="${entradaSaida}" method="POST" id="formAbrirCaixa">
								<div class="form-group">
									<input type="submit" value="ABRIR CAIXA"
										class="btn btn-primary" id="abrir-caixa">


								</div>
							</form>
						</div>
						<div id="fechar-caixa" th:if="${caixaAberto}">
							<form class="form-inline" th:action="@{/caixa/pre-fechar-caixa}">
								<div class="form-group">
									<input type="submit" value="FECHAR CAIXA"
										class="btn btn-danger">
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>



		<section id="fluxo" style="display: block;" th:if="${caixaAberto}">
			<div class="col-lg-8">
				<div class="block">
					<div class="title" align="center">
						<strong>CAIXA ABERTO</strong> <i class="material-icons"
							style="color: #429244"> monetization_on </i>
					</div>
					<div class="block-body">
						<form th:action="@{/caixa/adicionar}" th:object="${entradaSaida}"
							method="POST" id="formEntradaSaida">
							<div class="form-group">
								<div class="i-checks" align="center">
									<input th:each="to : ${tipooperacao}" th:value=${to}
										name="radios" class="radio-template" required="required"
										type="radio" th:text="${to.operacao}" style="margin: 6px"
										th:field="*{tipoOperacao}">
								</div>
							</div>
							<div id="esconderForm">
								<div class="form-group" id="tipoEntrada">
									<label for="categoriaEntrada">Segmento</label> <select
										id="categoriaEntrada" class="form-control" required="required"
										th:field="*{categoriaEntrada}">
										<option value="" selected="selected">Selecione...</option>
										<option th:each="cat : ${categoriaentrada}" th:value="${cat}"
											th:text="${cat.categoriaEntrada}">ATIVO</option>
									</select>
								</div>
								<div class="form-group">
									<label>Observação <span
										style="font-size: 11px; vertical-align: top; color: white">(
											Opcional )</span></label> <input type="text" id="descricao"
										placeholder="Observações aqui..." class="form-control"
										th:field="*{descricao}" maxlength="65">
								</div>
								<div class="form-group">
									<label>Valor R$</label> <input type="text" value="0"
										class="form-control" th:field="*{valor}" required="required">
								</div>
								<div class="form-group" id="descontoDiv">
									<label>Desconto % <span
										style="font-size: 11px; vertical-align: top; color: white">(
											Opcional )</span></label> <input type="text" value="0" class="form-control"
										th:field="*{desconto}" onChange="myFunction()">
									<button type="button" class="btn btn-warning btn-sm"
										id="btn_simular" style="margin-top: 6px">Simular
										Desconto</button>
								</div>
								<div class="form-group" id="formaPagamento">
									<label for="formaPagamento">Forma de pagamento</label> <select
										id="formaPagamento" class="form-control" required="required"
										th:field="*{formaPagamento}">
										<option value="" selected="selected">Selecione...</option>
										<option th:each="fp : ${formapagamento}" th:value="${fp}"
											th:text="${fp.pagamento}">ATIVO</option>
									</select>
								</div>
								<div class="form-group form-group-typeahead">
									<label id="idClienteFk">Cliente</label> <input
										id="typeaheadIdInstaNomeCliente2" type="text"
										placeholder="Pesquise por Nome ou @Instagram"
										class="form-control" th:field="*{cliente.id}"
										required="required">
								</div>
								<div class="form-group">
									<!-- 									<input type="text" class="form-control"	placeholder="Id do Caixa Referencial" th:field="*{caixa.id}" th:value="${idcaixadia}"> -->
									<div style="display: none">
										<select th:field="*{caixa.id}"><option
												th:value="${idcaixadia}"></option></select>
									</div>
									<div align="right">
										<button type="reset" class="btn btn-danger" id="enable">Limpar</button>
										<button type="submit" class="btn btn-primary">Gerar</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</section>
		<section class="no-padding-top" style="display: block"
			th:if="${caixaAberto}">
			<div class="container-fluid">
				<div class="block">
					<div class="title">
						<strong>Fluxo de Caixa Atual ( <span id="diaAs"> </span>
							)
						</strong>
					</div>
					<div class="block-body">
						<div class="table-responsive">
							<table id="dataTableFluxo" style="width: 100%;" class="table">
								<thead>
									<tr>
										<th></th>
										<th>Operação</th>
										<th>Valor</th>
										<th>Desconto</th>
										<th>Pagamento</th>
										<th>Segmento</th>
										<th>Cliente</th>
										<th>Data</th>
										<th></th>
										<th></th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="es :${teste}">
										<td><div th:if="${es.descricao != ''}">
												<i class="material-icons"
													style="align-self: center; color: #ffc107"
													data-toggle="popover" title="Observações"
													data-placement="left" data-container="body"
													th:attr="data-content=${#strings.concat(
											es.descricao,
											'  ',
	                                    )}">
													info </i>
											</div></td>
										<td th:switch="${#strings.capitalizeWords(es.tipoOperacao)}">
											<span style="color: #429244;" th:case="ENTRADA">ENTRADA</span>
											<span style="color: #bb414d;" th:case="SAIDA">SAIDA</span>
										</td>
										<td align="center" th:text="${es.valor}"></td>
										<td align="center"><span
											th:text="${#numbers.formatDecimal(es.desconto,2,0)} "></span>
											%</td>
										<td th:text="${es.formaPagamento}"></td>
										<td th:text="${es.categoriaEntrada}"></td>
										<td th:text="${es.cliente.nome}"></td>
										<td
											th:text="${#temporals.format(es.horarioOperacao, 'dd/MM hh:mm' )}"></td>
										<td><a sec:authorize="hasAnyRole('ADMIN', 'GERENTE')"
											th:href="@{/caixa/editar/{id} (id=${es.id})}" role="button">
												<span title="EDITAR" aria-hidden="true"
												style="color: white;"
												onmouseover="iconOnOverPersonalizado(this)"
												onmouseout="iconNormal(this)"><i
													class="material-icons">style</i></span>
										</a></td>
										<td><a sec:authorize="hasAnyRole('ADMIN', 'GERENTE')"
											th:href="@{/caixa/excluir/{id} (id=${es.id})}" role="button">
												<span title="EXCLUIR" style="color: #bb414d;"
												onmouseover="iconOnOverPersonalizado(this)"
												onmouseout="iconNormalPersonalizado(this)"><i
													class="material-icons">highlight_off</i></span>
										</a></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div th:if="${adicionou == true} " id="adicionou"></div>
		<div th:if="${erroAdicionar == true} " id="erroAdicionar"></div>
		<div th:if="${caixaFechado == true} " id="caixaFechado"></div>
		<div th:if="${caixaAbertoSucesso == true} " id="caixaAbertoSucesso"></div>
		<div th:if="${caixaReaberto == true} " id="caixaReaberto"></div>
		<div th:if="${caixaNaoLocalizado == true} " id="caixaNaoLocalizado"></div>
		<div th:if="${erroFecharCaixa == true} " id="erroFecharCaixa"></div>
		<div th:if="${caixaFechadoSucesso == true} " id="caixaFechadoSucesso"></div>
		<div th:if="${esNaoEncontrada == true} " id="esNaoEncontrada"></div>
	</div>
	<script type="text/javascript" layout:fragment="script">
		$(document).ready(function() {
			$('#clienteSalvo').show(function() {
				Messenger().post({
					message : 'Cliente salvo com sucesso!',
					type : 'success'
				});
			});
		});

		$(document)
				.ready(
						function() {
							$('#adicionou')
									.show(
											function() {
												Messenger()
														.post(
																{
																	message : 'Lançamento adicionado com sucesso!',
																	type : 'success'
																});
											});
							$('#erroAdicionar')
									.show(
											function() {
												Messenger()
														.post(
																{
																	message : 'Erro ao tentar inserir um novo lançamento!',
																	type : 'error'
																});
											});
							$('#caixaFechado')
									.show(
											function() {
												Messenger()
														.post(
																{
																	message : 'Impossivel inserir laçamento com caixa fechado!',
																	type : 'error'
																});
											});
							$('#caixaAbertoSucesso').show(function() {
								Messenger().post({
									message : 'Caixa foi aberto com sucesso!',
									type : 'success'
								});
							});
							$('#caixaReaberto').show(function() {
								Messenger().post({
									message : 'Caixa reaberto com sucesso!',
									type : 'success'
								});
							});
							$('#caixaNaoLocalizado')
									.show(
											function() {
												Messenger()
														.post(
																{
																	message : 'Não foi possoivel localizar o cliente',
																	type : 'error'
																});
											});
							$('#erroFecharCaixa').show(function() {
								Messenger().post({
									message : 'Erro ao tentar fechar o caixa',
									type : 'error'
								});
							});
							$('#caixaFechadoSucesso').show(function() {
								Messenger().post({
									message : 'O caixa foi fechado!',
									type : 'success'
								});
							});
							$('#esNaoEncontrada').show(function() {
								Messenger().post({
									message : 'Lançamento não encontrado',
									type : 'error'
								});
							});
						});

		var valor = $("#valor");
		var desconto = $("#desconto");
		$("#btn_simular").hide();

		function myFunction() {
			var x = document.getElementById("desconto");
			$("#btn_simular").show();
			if (desconto.val() == 0 || !desconto.val()) {

				$("#btn_simular").hide();
			}
		}

		$("#btn_simular")
				.click(
						function() {
							var descontoAplicado = (valor.val()
									* desconto.val() / 100);
							var valorComDesconto = valor.val()
									- descontoAplicado;
							Messenger()
									.post(
											{
												message : 'Valor com desconto aplicado: R$ '
														+ valorComDesconto,
												type : 'info'
											});
						});

		var hojeAs = moment().calendar();
		$("#diaAs").append("<strong>" + hojeAs + "</strong>");

		$("#esconderForm").hide();
		$(document).ready(function() {
			$('input:radio[name="tipoOperacao"]').change(function() {
				if ($("input[name='tipoOperacao']:checked")) {
					controleFormulario($(this).val());
				} else {
					alert("Erro, contate o suporte");
				}
			});
		});

		function controleFormulario(e) {
			if (e == 'ENTRADA') {
				$("#esconderForm").show();
				$("#descontoDiv").show();
				$("#clienteId").show();
				$("#typeaheadIdInstaNomeCliente2").val();
				$("#typeaheadIdInstaNomeCliente2").show();
				$("#idClienteFk").show();
			} else if (e == 'SAIDA') {
				$("#typeaheadIdInstaNomeCliente2").val(1);
				$("#typeaheadIdInstaNomeCliente2").hide();
				$("#idClienteFk").hide();
				$("#esconderForm").show();
				$("#btn_simular").hide();
				$("#descontoDiv").hide();
				$("#clienteId").hide();
			} else {
				alert("Erro, contate o suporte");
			}
		}

		$("input[name='valor']").TouchSpin({
			min : 0,
			max : 100000,
			step : 0.01,
			decimals : 2,
			boostat : 5,
			maxboostedstep : 100000,
			prefix : 'R$',
		});

		$("input[name='desconto']").TouchSpin({
			min : 0,
			max : 100,
			step : 5,
			boostat : 5,
			maxboostedstep : 10,
			prefix : '%',
		});

		$("input[name='creditoCliente']").TouchSpin({
			min : 0,
			max : 1000,
			boostat : 5,
			maxboostedstep : 10,
			prefix : 'R$',
		});

		$(document)
				.ready(
						function() {

							var diaAtual = moment().format('Do MMMM YYYY');

							$('#dataTableFluxo')
									.DataTable(
											{
												dom : 'lBfrtip',
												order : [],
												searching : true,
												buttons : [
														{
															extend : 'pdf',
															text : 'Gerar Relatório',
															className : 'btn btn-primary btn-sm',
															title : 'Fluxo Caixa '
																	+ diaAtual,
															exportOptions : {
																columns : ':visible'
															},
														},
														{
															extend : 'excel',
															text : 'Planilha',
															title : 'Fluxo Caixa '
																	+ diaAtual,
															className : 'btn btn-primary btn-sm',
															exportOptions : {
																columns : ':visible'
															},
														},
														{
															extend : 'print',
															className : 'btn btn-primary btn-sm',
															text : ' Imprimir',
															title : 'Fluxo Caixa '
																	+ diaAtual,
															exportOptions : {
																columns : ':visible'
															},
														} ],
												language : {
													"url" : "//cdn.datatables.net/plug-ins/1.10.19/i18n/Portuguese-Brasil.json"
												}
											});
						});
	</script>

</body>
</html>